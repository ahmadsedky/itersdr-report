
\title{Report on the ITER Clite Shutdown Doserate Calculations}
\author{
  Andrew Davis \\
  Department of Engineering Physics\\
  College of Engineering \\
  The University of Wisconsin-Madison\\
  Madison, Wisconsin, 53706, \underline{USA}
  \and
  Mohamed Sawan \\
  Department of Engineering Physics\\
  College of Engineering \\
  The University of Wisconsin-Madison\\
  Madison, Wisconsin, 53706, \underline{USA}
  \and
  Elliott Biondo \\
  Department of Engineering Physics\\
  College of Engineering \\
  The University of Wisconsin-Madison\\
  Madison, Wisconsin, 53706, \underline{USA}
  \and
  Ahmed Ibrahim \\
  Radiation Transport Group\\
  Oak Ridge National Laboratory \\
  P.O. Box 2008 \\
  Oak Ridge, Tennessee 37831, \underline{USA}
  \and
  Patrick Shriwise \\
  Department of Engineering Physics\\
  College of Engineering \\
  The University of Wisconsin-Madison\\
  Madison, Wisconsin, 53706, \underline{USA}
}

\date{\today}

\documentclass[12pt]{article}
%\usepackage[printwatermark]{xwatermark}
\usepackage{graphicx}
\usepackage[a4paper, portrait, margin=0.5in]{geometry}
\usepackage[table]{xcolor}
\usepackage{subcaption}
\usepackage{multirow}

\usepackage{draftwatermark}
\SetWatermarkText{DRAFT}
\SetWatermarkScale{5}

\begin{document}
\maketitle
\newpage
\tableofcontents
\newpage
\section{Introduction}
The shutdown doserate in an around the equatorial and upper ports determine the type and duration of maintenance that can be
performed by person access. Thus, minimization of the dose rate is desirable and indeed encouraged by the ALARA principles used
at ITER. It was recently suggested in the Neutronics Task Force that lining the plasma side of the concrete bioshield with a
thin ($\sim$ mm thickness) layer of boron carbide (B$_4$C). The purpose of the layer is to absorb much of the thermal flux
which would otherwise lead to neutron induced activation, typically (n,$\gamma$) capture reactions. Simple scoping calculations
have suggested that the thermal neutron flux should be depressed significantly and lead to signficantly lower shutdown photon
doserates, close to an order of magnitude. The main goal of this report was therefore to examine if the use of the B$_4$C liner
does indeed lead to lower doserates, this would be achived by modelling a detailed 40$^{\circ}$ sector of the ITER device once
with the layer included and once without.
\newpage
\section{The CAD Model}
The CAD model was generated from several sources, ITER Clite CAD which was used as input to generate the ITER Clite V1 MCNP model, ITER Diagnostics Division CAD models of Upper and Equatorial ports, and previous MCNP analysis which were detailed in \cite{cad_origination}. The model represents several ITER systems in high levels of detail, with all detail retained in the Equatorial Port Interspace (EPI), the  Upper Port Interspace (UPI), and the Lower Port Cryopump. Some of these models were previsouly used to generate MCP input decks so have undergone some degree of simplification. 
\subsection{Clite CAD Model}
The overall CAD model in shown in Figure \ref{fig:cad_iter_global}, the broad details of the model can be seen. 
\begin{figure}[ht!]
  \centering
  \includegraphics[scale=0.8]{../plots/cad/global.png}
  \caption{Section showing the overall model}
  \label{fig:cad_iter_global}
\end{figure}

\begin{figure}[p]
  \centering
  \includegraphics[scale=0.32]{../plots/cad/mats/label_1.png}
  \includegraphics[scale=0.32]{../plots/cad/mats/label_2.png}
  \caption{Section some of the major tokamak materials}
  \label{fig:material_assign_1}
\end{figure}

\begin{figure}[p]
  \centering
  \includegraphics[scale=0.32]{../plots/cad/mats/label_3.png}
  \caption{Section some of the major tokamak materials}
  \label{fig:material_assign_2}
\end{figure}

\newpage
\clearpage
\subsection{Materials}
All materials in the problem originate from the Clite MCNP model - CLITE\textunderscore V1\textunderscore REV131031\textunderscore MOD, with the exception of the Upper Port Plugs (UPP), the Equatorial Port Plug (EPP), the Cryopump, the blanket modules and the contents of the UPI and EPI. The default cross section set used was FENDL-2.1, with the exception of XX which was expanded into an isoptopic defintion and used the ENDF-VIIR1 evaluation. The EPP material definitions were taken from the Generic Equatorial Port Plug (GEPP) MCNP model \cite{epp_materials}. The UPP material definitions were provided by \cite{bertalot_communication}. The Cryopump materials assignments came from \cite{cryopump_communication}. The blanket module material compositions were taken from the Bl-lite CAD model since the blankets were homogenized identically in this model. The full evaluated material definitions can be found in the Appendix.
\subsection{Variance Reduction}
The weight window parameters were generated using the Oak Ridge National Laboratory (ORNL) code ADVANTG, specifically using DAG-ADVANTG, which allows a DAGMC geometry to be read and the geometry and material data handed off to Denovo. The weight windows used for the problem are shown below in Figure \ref{fig:wwinp}. The weight windows were produced using the Forward Weighted Consistent Adjoint Driven Importance Sampling (FW-CADIS), which attempts to produce a weight window map which tries to get particles everywhere int the model, as opposed to CADIS for example, which attempts to get results to a small number of specific regions.
\begin{figure}[ht!]
  \centering
  \includegraphics[scale=0.4]{../plots/wwinp/wwinp_y0.png}
  \includegraphics[scale=0.3]{../plots/wwinp/wwinp_z0.png}
  \caption{Slices through the ADVANTG produced weight window through y = 0.0 cm and through z = 0.0 cm}
  \label{fig:wwinp}
\end{figure}
Several artifacts are worthy of note, despite being a deterministic code Denovo has handled the streaming of neutrons along the divertor duct well as shown in left hand image of Figure \ref{fig:wwinp}. The overall span of the weight window is seven orders of magnitude, which is largely proportional to the neutron attenuation from the plasma to the port interspace, previous calculations put the attenuation in the range of 6 to 8 orders of magnitude. There is some evidence of ray effects in the weight window solution in the right hand image of Figure \ref{fig:wwinp} due to the neutron attenuation of some EPI shielding around the diagnostic equipment, but this is small deviation in an otherwise reasonable solution.
\\
\\
It should be noted that ORNL specifically developed the 360$^{\circ}$ rotation feature for DAG-ADVANTG that allows rotationally symmetric bodies, which is the reason for the weight window values beyond the 40$^{\circ}$ sector.
\newpage
\section{Tools}
\subsection{DAGMC}
The Direct Accelerated Geometry Monte Carlo (DAGMC) is a toolkit developed at the University of Wisconsin-Madison designed specifically for ray tracing efficiently on complex CAD based geometries. The DAGMC toolkit is distributed as part of the Mesh Orientated dABase (MOAB) and is completely open source. Input to DAGMC is a MOAB mesh file which contains the faceted representation of the CAD geometry, this is loaded and Oriented Bounding Box (OBB) acceleration structures are built to speed each ray fire query.
\subsection{DAG-MCNP5}
DAG-MCNP5 \cite{dagmc} is a version of MCNP \cite{mcnp} where the core ray queries (point in volume, ray fire, next volume, etc) have their MCNP versions replaced with the DAGMC equivlents. DAG-MCNP5 has been validated \cite{dagmc_validation} and tested in several ITER analysis in the past.
\subsection{PyNE}
The Python for Nuclear Engineering (PyNE) \cite{Scopatz2012b} project aims to make C++ wrapped Python-accessible library of well validated and tested functions and capabilities available to nuclear engineers across the world. For this project we used the following capabilities of PyNE.
\begin{itemize}
  \item{the \texttt{pyne.mesh} class to combine meshes, with an appropriate combined statistical error}
  \item{the \texttt{pyne.r2s} class to produce R2S inputs and outputs}
  \item{the \texttt{pyne.alara} class to produce alara inputs}
  \item{the \texttt{pyne.mcnp} class to read MCNP meshtal files}
\end{itemize}
\subsection{R2S}
The methods contained within \texttt{pyne.r2s} \cite{pyne_r2s} represent an open source implementation of a mesh based coupling between MC output and nuclear inventory code input using the so called Rigorous two Step (R2S) \cite{Chen2002107} method. MCNP produced neutron mesh tall(y/ies) (or DAGMC produced tetrahedral mesh) are read into a PyNE mesh, using that mesh as the basis for the inventory calculation, the underlying CAD geometry is discretised onto the mesh and a fully consistent activation problem is generated for ALARA. The output of that ALARA calculation is then placed into a MOAB (*.h5m) file ready to be read and sampled from using the appropriate source sampling routine.
\subsection{ALARA}
AlARA \cite{alara} is a nuclear inventory code developed at the University of Wisconsin-Madison. The unique feature of ALARA is the way it handles the pathways of the reactions, all of the potential pathways are accounted for and duplicate links linearised. ALARA is used in this analysis as the method of producing gamma ray sources for R2S shutdown photon calculations.
\newpage
\section{Neutron Transport Results}
\subsection{Problem Setup}
The neutron transport calculations were performed using version 1.0 of DAG-MCNP5 using the source from version 1.60 of MCNP5, from the develop branch with git checkout \texttt{e12e2a3}. The two batches of calculations were performed, one case with the B$_4$C liner and one without. Due to the large amount of RAM required to run these jobs (in excess of 12 Gb per CPU) these jobs were considered a good case to run using a high throughput methodology. In this method the spatial domain of the problem is duplicated several times but the random number seed is strided in such a way that no CPU will share the same seed with another job.

\begin{figure}[ht!]
  \centering
  \includegraphics[scale=0.4]{../plots/transport/job_splits.png}
  \caption{The seven different mesh domains, (left) shown with some transparency to indicate where the major boundaries end and (right) showing the absolute
  scale of the mesh elements}
  \label{fig:mesh_domains}
\end{figure}

The calculation was split into seven calculation domains, shown in Figure \ref{fig:mesh_domains}, which bound the regions of the problem requiring activation. The physical size and boundaries that were used in the calculation can be found in Table \ref{table:mesh_sizes}. With R2S calculations there is a subtle interplay between the size of the mesh elements and the number of mesh elements; the larger the mesh elements the lower the statistical errors will be for a given fixed number of particles but the mesh will conform poorly to the geometry, and vice versa. In this calculation the maximum number of mesh elements in a given mesh is dictated by the size that the given mesh will occupy in memory when transferred to an ALARA geometry. 

\begin{centering}
 \begin{table}[ht!]
  \begin{tabular}{c | c | c | c | c}
  \hline 
  Mesh & Dimension & Start position (cm) & End position (cm) & Number of bins\\
  \hline 
  \multirow{3}{*}{Mesh 1} & X & 0.0 & 500.0 & 25 \\ & Y & -250.0 & -250.0 & 25 \\ & Z & -1500.0 & 1900.0 & 170 \\
  \hline
  \multirow{3}{*}{Mesh 2} & X & 500.0 & 1100.0 & 30 \\ & Y & -500.0 & 500.0 & 50 \\ & Z & 400.0 & 1900.0 & 75 \\
  \hline
  \multirow{3}{*}{Mesh 3} & X & 500.0 & 1100.0 & 30 \\ & Y & -500.0 & 500.0 & 50 \\ & Z & -1500.0 & -300.0 & 60 \\
  \hline
  \multirow{3}{*}{Mesh 4} & X & 500.0 & 1100.0 & 30 \\ & Y & -500.0 & 500.0 & 50 \\ & Z & -300.0 & 400.0 & 35 \\
  \hline
  \multirow{3}{*}{Mesh 5} & X & 1100.0 & 1700.0 & 30 \\ & Y & -600.0 & 600.0 & 60 \\ & Z & -1500.0 & -300.0 & 60 \\
  \hline
  \multirow{3}{*}{Mesh 6} & X & 1100.0 & 1700.0 & 60 \\ & Y & -600.0 & 600.0 & 60 \\ & Z & 400.0 & 1900.0 & 75\\
  \hline
  \multirow{3}{*}{Mesh 7} & X & 1100.0 & 1700.0 & 30 \\ & Y & -600.0 & 600.0 & 60 \\ & Z & -300.0 & 400.0 & 36 
  \end{tabular}
 \caption{The meshes used in the problem, their start and end coordinate and number of divisions}
 \label{table:mesh_sizes}
 \end{table}
\end{centering}

Having been split appropriately, these jobs were submited to the University of Wisconsin's Centre for High Throughput Computer (CHTC) system in batches of 200 for each mesh, with seven meshes used to determine the neutron flux, making a total of 2800 individual MCNP simulations. These results were then combined using PyNE to result in the statistically averaged final results. Intially calculations were batched into groups of $5\times10^7$ particles per batch, however these calculations did not finish in a timely enough manner and were instead reduced to groups of $5\times10^6$ particles per batch. With the smaller batching system calculations did finish, however, only 10\% of all calculations for each mesh finished, but this represents $5\times10^7$ total source histories for each mesh. 
\newpage
\clearpage
\subsection{Without the B4C Liner}
The baseline results represent a standard C-lite model since there is no B$_4$C liner present, however relative to the standard C-lite native MCNP model there is much more equipment present in the port inspaces (both upper and lower), and the divertor pumping port is unplugged. 
\begin{figure}[ht!]
  \centering
  \includegraphics[scale=0.35]{../plots/neutron/nob4c/y_0.png}
  \includegraphics[scale=0.35]{../plots/neutron/nob4c/y_-17.png}
  \caption{Slices through the total neutron flux (n cm$^{-2}$ src$^{-1}$) y = -17.0 cm and through z = 0.0 cm}
  \label{fig:wwinp}
\end{figure}
\begin{figure}[ht!]
  \centering
  \includegraphics[scale=0.27]{../plots/neutron/nob4c/z_-500.png}
  \includegraphics[scale=0.27]{../plots/neutron/nob4c/z_0.png}       
  \includegraphics[scale=0.27]{../plots/neutron/nob4c/z_500.png}
  \caption{Slices through the total neutron flux (n cm$^{-2}$ src$^{-1}$) z = -500.0 cm and through z = 500.0 cm}
  \label{fig:wwinp}
\end{figure}
\newpage
\clearpage
\subsection{Including the B4C Liner}
These results represent a standard C-lite model with improved B$_4$C liner, however relative to the standard C-lite native MCNP model there is much more equipment present in the port inspaces (both upper and lower), and the divertor pumping port is unplugged. 
\begin{figure}[ht!]
  \centering
  \includegraphics[scale=0.35]{../plots/neutron/b4c/flux_y0.png}     
  \includegraphics[scale=0.35]{../plots/neutron/b4c/flux_y-17.png}
  \caption{Slices through the total neutron flux (n cm$^{-2}$ src$^{-1}$) y = -17.0 cm and through z = 0.0 cm}
  \label{fig:wwinp}
\end{figure}
\begin{figure}[ht!]
  \centering
  \includegraphics[scale=0.27]{../plots/neutron/b4c/flux_z-500.png}
  \includegraphics[scale=0.27]{../plots/neutron/b4c/flux_z0.png}       
  \includegraphics[scale=0.27]{../plots/neutron/b4c/flux_z500.png}
  \caption{Slices through the total neutron flux (n cm$^{-2}$ src$^{-1}$) z = -500.0 cm and through z = 500.0 cm}
  \label{fig:wwinp}
\end{figure}
\newpage
\clearpage
\section{Neutron Activation}
The R2S shutdown dose rate calculations were performed using the pyne.r2s methods found PyNE. The setup scripts produce ALARA inputs and the neutron activation calculations were performed using ALARA 2.9.1RC which used the FENDL-3.0/A activation cross sections. 
\subsection{Irradiation Scenario}
\begin{table}[ht!]
   \begin{tabular}{| l | c |}
      \hline 
      Irradiation Period & Fractional Strength \\
      \hline
      5 Years & 0.0095 \\
      1 Year  & 0.0127 \\
      1 Year  & 0.0190 \\
      1 Year  & 0.0317 \\
      1 Year  & 0.0380 \\
      1 Year  & 0.0380 \\
      6 Days  & 0.1929 \\
      1 Year  & 0.0380 \\
      \cellcolor{blue!25} 400 Seconds & 1.0000 \\
      \cellcolor{blue!25}1673.6 Seconds & 0.0000 \\
      400 Seconds & 1.0000 \\
      \hline
\end{tabular}
\caption{The table shows the ITER-DRG2 scenario for aggresive pulsing, note the cells in \textcolor{blue!25}{blue} are repeated 249 times}
\label{tag:irrad_scenario}
\end{table}

\subsection{Including the B4C Liner}
\subsection{Without the B4C Liner}
\newpage
\section{Shutdown Photon Doserates}
The shutdown photon sources were developed in several seperate meshes and therefore any individual mesh does not represent the entire problem. The results of the previous ALARA calculations are then processed further to make shutdown sources to be read into a sampling subroutine (also distributed with PyNE) Each source is run independently, and the photon dose is recorded on a mesh common to each photon calculation and then the meshes summed together to create the final result. The final mesh has a uniform size of side 2 cm striding from x = {0,1500}, y = {-500,500}, z = {-1900,1500} cm. The meshes used the ICRP-74 dose response coeffiecients as a dose multiplier as recommended in \cite{iter_sdr_coeffs}.
\subsection{Decay time 1 - 1.$\times$10$^5$ s}
\subsection{Decay time 2 - 1.$\times$10$^6$ s}
\subsection{Decay time 3 - 1.$\times$10$^7$ s}
\section{Conclusions}
\subsection{Neutron Transport}
The final calulcations represent only around 10\% of the overall requested runtime, this is mostly due to calculations not completing with the 3 day allotted runtime on CHTC, the reason being that is seems the requested VR parameters were too extreme resulting in severe oversplitting of particles. This has been noticed to occur in several previous challenging attenuating geometries and has been attributed to so called long histories. The long history problem requires an ultimate solution beyond the scope of this report, but perhaps solutions like that already underway at UW-Madison \& ORNL; GT-CADIS \& MS-CADIS respectively.
\subsection{Shutdown Photon Doserate}
It is clear from Figures XXX that the shutdown photon doserate in the port interspaces is affected by the addition of boron carbide to the plasma side surface of the bioshield. The reason for the this is significantly degraded thermal flux which impacts the inportance of (n,$\gamma$) reactions and also the transport of neutrons back from the bioshield. The true benefit appears only to be very close to the B$_4$C layer, where is reduces the activation of steel componenets near to the bioshield, those components away from the bioshield appear to have their activation dominated by the neutron tranported via long paths around other ports, known as cross talk.
\subsection{Future Work}
\bibliographystyle{unsrt}
\bibliography{bibliography}
\newpage
\section{Appendix}
\input{materials.tex}
\end{document}
This is never printed
